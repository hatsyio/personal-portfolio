#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if package.json is staged
if git diff --cached --name-only | grep -q "package.json"; then
  # Check if pnpm-lock.yaml is also staged
  if ! git diff --cached --name-only | grep -q "pnpm-lock.yaml"; then
    echo ""
    echo "‚ùå ERROR: package.json is staged but pnpm-lock.yaml is not!"
    echo ""
    echo "Run 'pnpm install' to update the lockfile, then stage it:"
    echo "  pnpm install"
    echo "  git add pnpm-lock.yaml"
    echo ""
    exit 1
  fi
fi

# Run the lockfile check
if [ -f "package.json" ]; then
  echo "üîç Checking if lockfile is up to date..."
  if ! pnpm install --frozen-lockfile > /dev/null 2>&1; then
    echo ""
    echo "‚ùå ERROR: pnpm-lock.yaml is out of sync with package.json"
    echo ""
    echo "Run 'pnpm install' to update the lockfile:"
    echo "  pnpm install"
    echo "  git add pnpm-lock.yaml"
    echo ""
    exit 1
  fi
  echo "‚úÖ Lockfile is up to date"
fi

